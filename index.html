<!DOCTYPE html>
<html lang="id-ID">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KYRT CDN — OpenDN Foundation — PHPin Labs</title>

  <!-- Bootstrap CSS (CDN) -->
  <link href="https://npmcdn.kyrt.my.id/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --accent: #0d6efd;
      --bg: #f6f8fb;
      --card: #ffffff;
      --muted: #6c757d;
      --ok: #198754;
      --warn: #ffc107;
      --bad: #dc3545;
      --reval: #38bdf8;
    }

    html,body{height:100%;background:var(--bg);font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;margin:0;padding:0;}

    /* --- Splashscreen --- */
    .splash {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, #e9f0ff 0%, #ffffff 60%);
      z-index:1050;
      flex-direction:column;
      padding:24px;
      transition:opacity .5s ease, transform .5s ease;
    }
    .splash.hidden {
      opacity:0;
      pointer-events:none;
      transform: translateY(-8px) scale(.995);
    }

    .logo img { width:96px; height:96px; border-radius:18px; object-fit:cover; }
    .splash .logo { width:96px; height:96px; border-radius:18px; }

    .splash h1 { margin:0; font-size:1.05rem; color:#0b2545; font-weight:700; }
    .splash p { margin:6px 0 14px 0; color:var(--muted); font-size:0.92rem; }

    .dots { display:inline-flex; gap:8px; margin-top:6px; }
    .dot { width:10px; height:10px; border-radius:50%; background:rgba(0,0,0,0.12); animation: blink 1s infinite ease-in-out; }
    .dot:nth-child(2){ animation-delay: .12s; }
    .dot:nth-child(3){ animation-delay: .24s; }
    .dot:nth-child(4){ animation-delay: .36s; }
    @keyframes blink {
      0% { opacity:.18; transform: translateY(0); }
      50% { opacity:1; transform: translateY(-6px); }
      100% { opacity:.18; transform: translateY(0); }
    }

    /* --- Page content --- */
    .page { min-height:100%; display:flex; flex-direction:column; }
    .main { flex:1; padding:48px 18px; display:flex; align-items:center; justify-content:center; }

    /* content card */
    .card-app { max-width:980px; width:100%; background:var(--card); border-radius:14px; box-shadow: 0 10px 30px rgba(11,20,40,0.06); padding:28px; }

    .brand { display:flex; gap:12px; align-items:center; }
    .logo-sm { width:44px; height:44px; border-radius:10px; }
    .logo-sm img { width: 44px; height: 44px; border-radius: 10px; }

    .muted { color:var(--muted); }

    .status-bullet { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:8px; }
    .latency-bar { height:10px; border-radius:6px; background:linear-gradient(90deg,var(--ok),var(--warn),var(--bad)); opacity:.12; overflow:hidden; }
    .latency-fill { height:100%; background:linear-gradient(90deg,var(--ok),#ffc95f); width:0%; border-radius:6px; transition: width .36s ease; }
    .sparkline { width:100%; height:36px; display:block; }

    .small-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:0.85rem; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; }

    pre { color: #6f42c1; white-space:pre-wrap; word-break:break-word; font-family: ui-monospace, Menlo, Monaco, monospace; font-size:0.9rem; }
    .btn:focus { outline: 3px solid rgba(13,110,253,0.16); outline-offset:2px; border-radius:6px; }

    @media (prefers-reduced-motion: reduce) {
      .dot { animation: none; }
      .splash, .splash.hidden { transition: none; transform: none; opacity: 1; }
      .latency-fill { transition: none; }
    }
  </style>
</head>
<body>
  <!-- Splashscreen -->
  <div id="splash" class="splash" role="dialog" aria-modal="true" aria-label="Splashscreen — Memuat aplikasi">
    <div class="logo" aria-hidden="true"><img src="https://kyrt.my.id/assets/cdn_logo.jpg" alt="KYRT CDN Logo" /></div>
    <h1 class="m-3">KYRT CDN</h1>
    <p class="muted">Fast • Easy • Safe CDN</p>

    <div class="dots" aria-hidden="true" title="Loading indicator">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>
  </div>

  <!-- Page content -->
  <div class="page" id="page" aria-hidden="true">
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" href="#">
          <div class="logo-sm" aria-hidden="true"><img src="https://kyrt.my.id/assets/cdn_logo.jpg" alt="KYRT" /></div>
          <div>
            <div style="font-weight:700">KYRT CDN</div>
            <small class="muted">Light & fast</small>
          </div>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navMain">
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
            <li class="nav-item"><a class="nav-link" href="#docs">Docs</a></li>
            <li class="nav-item ms-2"><a class="btn btn-outline-primary btn-sm" href="#">Get Started</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="main">
      <div class="card-app">
        <div class="row g-4">
          <div class="col-md-8">
            <h2>Selamat datang di KYRT CDN</h2>
            <p class="muted">Sebuah CDN ringan untuk paket statismu — cepat, aman, dan mudah digunakan.</p>

            <h5 id="about" class="mt-4">Kenapa KYRT?</h5>
            <ul>
              <li>Distribusi cepat untuk file statis</li>
              <li>Mudah diintegrasikan lewat URL sederhana</li>
              <li>Sederhana: fokus pada performa</li>
            </ul>

            <h5 id="docs" class="mt-3">Contoh pemakaian</h5>
            <pre class="bg-light p-3 small-mono rounded">
&lt;!-- Load KYRT Icon --&gt;
&lt;link rel="stylesheet" href="https://cdn.kyrt.my.id/libs/css/kyrt-icon/1.0.0/kyrt-icon.min.css"&gt;
            </pre>
            <pre class="bg-light p-3 small-mono rounded">
&lt;!-- Load ZFecth --&gt;
&lt;script src="https://cdn.kyrt.my.id/libs/js/zfecth/1.0.0/zfecth.min.js"&gt;&lt;/script&gt;
            </pre>

            <div class="mt-4">
              <h6>Live Status (Realtime)</h6>
              <p class="muted">Dengan RTWM (Real Time Website Monitoring) Dari KYRT Untuk Melihat Website CDN Kami.</p>

              <div id="liveStatus" class="row g-2 align-items-center">
                <div class="col-12 col-md-6">
                  <div class="d-flex align-items-center">
                    <span id="statusBullet" class="status-bullet" style="background:var(--warn)"></span>
                    <div>
                      <div class="small text-muted">Server</div>
                      <div id="serverStatus" class="fw-bold">—</div>
                    </div>
                  </div>
                </div>

                <div class="col-6 col-md-3">
                  <div class="small text-muted">Latency</div>
                  <div class="d-flex align-items-center">
                    <div class="me-2 small-mono" id="latencyText">— ms</div>
                    <div style="flex:1">
                      <div class="latency-bar" aria-hidden="true">
                        <div id="latencyFill" class="latency-fill" style="width:0%"></div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-6 col-md-3">
                  <div class="small text-muted">Bandwidth</div>
                  <div class="fw-semibold small-mono" id="bandwidthText">—</div>
                </div>

                <div class="col-6 col-md-4 mt-2">
                  <div class="small text-muted">Cache</div>
                  <div id="cacheText" class="fw-semibold">—</div>
                </div>

                <div class="col-6 col-md-4 mt-2">
                  <div class="small text-muted">HTTP</div>
                  <div id="statusCodeText" class="fw-semibold">—</div>
                </div>

                <div class="col-12 col-md-4 mt-2">
                  <div class="small text-muted">Last update</div>
                  <div id="lastUpdate" class="fw-semibold small-mono">—</div>
                </div>

                <div class="col-12 mt-3">
                  <div class="small text-muted mb-2">Latency (history)</div>
                  <svg id="spark" class="sparkline" viewBox="0 0 100 36" preserveAspectRatio="none" aria-hidden="true"></svg>
                </div>

                <div class="col-12 mt-2">
                  <div class="d-flex gap-2">
                    <button id="forceBtn" class="btn btn-sm btn-outline-primary">Cek Sekarang</button>
                    <button id="pauseBtn" class="btn btn-sm btn-outline-secondary">Pause</button>
                    <div class="form-check ms-auto">
                      <input class="form-check-input" type="checkbox" value="" id="showRaw" checked>
                      <label class="form-check-label small" for="showRaw">Tampilkan raw JSON</label>
                    </div>
                  </div>
                </div>

                <div class="col-12 mt-3">
                  <pre id="rawJson" class="bg-light p-2 rounded small-mono" style="display:block;max-height:220px;overflow:auto">{/* json */}</pre>
                  <p class="small text-muted">Powered By: Render</p>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="border rounded p-3">
              <h6>Quick Info</h6>
              <dl>
                <dt class="muted">Status</dt>
                <dd id="quickStatus">—</dd>
                <dt class="muted">Latency</dt>
                <dd id="quickLatency">—</dd>
                <dt class="muted">Uptime</dt>
                <dd id="quickUptime">—</dd>
                <dt class="muted">Origin Uptime</dt>
                <dd id="quickOriginUptime">—</dd>
              </dl>
              <a class="btn btn-primary btn-sm w-100 mt-2" href="https://github.com/KhairyK/kyrtcdn/issues">Request Package</a>
            </div>
          </div>
          <div class="col-12">
            <div class="bg-light small rounded p-3">
              <h3 class="mt-2 mb-2">Cara Memakai</h3>
              <p class="text-muted fw-bold">Anda Hanya Memasukkan Beberapa Path Untuk Menuju Ke Paket Yang Anda Mau Pakai<br>Contoh:</p>
              <h4 class="mb-2 mt-3">https://cdn.kyrt.my.id/libs/:package/:version/:file</h4>
            </div>
          </div>
        </div>

        <footer class="mt-4 border-top pt-3">
          <div class="d-flex justify-content-between align-items-center">
            <small class="muted">© <span id="year"></span> OpenDN Foundation — Built by PHPin Labs</small>
            <div>
              <a class="muted me-2" href="#">Docs</a>
              <a class="muted" href="#">Privacy</a>
            </div>
          </div>
        </footer>
      </div>
    </main>
  </div>

  <!-- Bootstrap JS bundle -->
  <script defer src="https://npmcdn.kyrt.my.id/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function () {
      /* =========== splash logic =========== */
      const splash = document.getElementById('splash');
      const page = document.getElementById('page');
      const AUTO_HIDE_MS = 4500;

      function showPage() {
        if (!splash) return;
        splash.classList.add('hidden');
        splash.setAttribute('aria-hidden', 'true');
        page.removeAttribute('aria-hidden');
        setTimeout(() => {
          if (splash && splash.parentNode) splash.parentNode.removeChild(splash);
        }, 700);
      }

      let autoTimer = setTimeout(showPage, AUTO_HIDE_MS);
      document.addEventListener('keydown', (ev) => {
        if (ev.key === 'Escape') {
          clearTimeout(autoTimer);
          showPage();
        }
      });
      window.addEventListener('load', () => {
        clearTimeout(autoTimer);
        autoTimer = setTimeout(showPage, Math.max(600, AUTO_HIDE_MS));
      });
      document.getElementById('year').textContent = new Date().getFullYear();
      setTimeout(() => { const el = document.querySelector('.btn-primary'); if (el) el.focus(); }, AUTO_HIDE_MS + 300);
      window.__kyrt_showPage = showPage;

      /* =========== realtime status logic =========== */

      // default endpoint (bisa di-override lewat ?endpoint=...)
      const DEFAULT_ENDPOINT = 'https://m.kyrt.my.id/monitor';
      const urlParams = new URLSearchParams(location.search);
      const STATUS_ENDPOINT = urlParams.get('endpoint') || DEFAULT_ENDPOINT;
      const POLL_MS = 1500;

      // elements
      const statusBullet = document.getElementById('statusBullet');
      const serverStatus = document.getElementById('serverStatus');
      const latencyText = document.getElementById('latencyText');
      const latencyFill = document.getElementById('latencyFill');
      const bandwidthText = document.getElementById('bandwidthText');
      const cacheText = document.getElementById('cacheText');
      const statusCodeText = document.getElementById('statusCodeText');
      const lastUpdate = document.getElementById('lastUpdate');
      const spark = document.getElementById('spark');
      const rawJson = document.getElementById('rawJson');
      const showRaw = document.getElementById('showRaw');
      const forceBtn = document.getElementById('forceBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const quickStatus = document.getElementById('quickStatus');
      const quickLatency = document.getElementById('quickLatency');
      const quickUptime = document.getElementById('quickUptime');
      const quickOriginUptime = document.getElementById('quickOriginUptime');

      let running = true;
      let timerId = null;
      let history = []; // last N latencies
      const MAX_HISTORY = 30;

      // helper: human readable bytes
      function humanBytes(n) {
        if (n === null || n === undefined) return '—';
        const thresh = 1024;
        let num = Number(n);
        if (!isFinite(num)) return '—';
        if (Math.abs(num) < thresh) return num + ' B';
        const units = ['KB','MB','GB','TB'];
        let u = -1;
        do {
          num /= thresh;
          ++u;
        } while(Math.abs(num) >= thresh && u < units.length - 1);
        return num.toFixed((u<1)?0:1) + ' ' + units[u];
      }

      // helper: safe get css var, fallback to value
      function getCSSVar(name, fallback) {
        const v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        return v || (fallback || name);
      }

      // choose color based on latency
      function onlineColorFromLatency(lat) {
        if (lat === 0 || lat === null || lat === undefined) return getCSSVar('--muted', '#9aa3b2');
        if (lat < 150) return getCSSVar('--ok', '#198754');
        if (lat < 400) return getCSSVar('--warn', '#ffc107');
        return getCSSVar('--bad', '#dc3545');
      }

      // draw sparkline from history array (values in ms)
      function drawSpark(values) {
        const w = 100, h = 36, pad = 4;
        const vals = values.slice();
        const maxVal = Math.max(100, ...vals);
        const len = vals.length;
        let path = '';
        for (let i = 0; i < len; i++) {
          const x = Math.round(i * (w / Math.max(1, len - 1)));
          const v = vals[i] || 0;
          const y = h - pad - Math.round(((v) / maxVal) * (h - pad * 2));
          path += (i === 0 ? `M ${x} ${y}` : ` L ${x} ${y}`);
        }
        if (len === 0) path = `M0 ${h/2} L ${w} ${h/2}`;
        spark.innerHTML = '';
        const stroke = onlineColorFromLatency(vals.length ? vals[vals.length - 1] : 0);
        const svgNS = 'http://www.w3.org/2000/svg';
        const poly = document.createElementNS(svgNS, 'path');
        poly.setAttribute('d', path);
        poly.setAttribute('fill', 'none');
        poly.setAttribute('stroke', stroke);
        poly.setAttribute('stroke-width', '2');
        poly.setAttribute('stroke-linejoin', 'round');
        poly.setAttribute('stroke-linecap', 'round');
        spark.appendChild(poly);
      }

      // safe parse number
      function asNumber(x, fallback = null) {
        const n = Number(x);
        return Number.isFinite(n) ? n : fallback;
      }

      // main UI update
      function updateUI(data) {
        const online = !!data.online;
        serverStatus.textContent = online ? 'Online' : 'Offline';
        statusBullet.style.background = online ? getCSSVar('--ok') : getCSSVar('--bad');
        quickStatus.textContent = online ? 'Online' : 'Offline';

        // latency
        const latency = asNumber(data.latency ?? data.time ?? data.ping, null);
        latencyText.textContent = latency === null ? '— ms' : `${latency} ms`;
        quickLatency.textContent = latency === null ? '—' : `${latency} ms`;

        // bandwidth
        const bandwidth = asNumber(data.bandwidth ?? data.size ?? data.bandwidthBytes, 0);
        bandwidthText.textContent = humanBytes(bandwidth);

        // cache
        const cache = String(data.cache || (data.headers && (data.headers['x-cache'] || data.headers['x-nf-cache'])) || '').toUpperCase();
        cacheText.textContent = cache || '—';
        cacheText.style.color =
         cache === 'HIT' ? getCSSVar('--ok') :
         cache === 'MISS' ? getCSSVar('--bad') :
         cache === 'REVALIDATED' ? getCSSVar('--reval') : 'inherit';

        // http status
        statusCodeText.textContent = data.statusCode || data.status || (data.raw && data.raw.statusCode) || '—';

        // last update (timestamp in ms or seconds)
        const ts = data.timestamp ?? (data.raw && data.raw.timestamp) ?? Date.now();
        // if looks like seconds convert to ms
        const tnum = Number(ts);
        const tms = (tnum < 1e12) ? tnum * 1000 : tnum;
        lastUpdate.textContent = new Date(tms).toLocaleString();

        // uptime display
        // prefer formatted fields if present; else build percent
        const uptimeFormatted = data.uptimeFormatted || (typeof data.uptime === 'string' ? data.uptime : null);
        const originFormatted = data.originUptimeFormatted || null;
        const uptimePercent = asNumber(data.uptime, null); // if server provides percent
        if (uptimeFormatted) {
          quickUptime.textContent = uptimeFormatted;
        } else if (uptimePercent !== null) {
          quickUptime.textContent = `${uptimePercent}%`;
        } else {
          quickUptime.textContent = '—';
        }
        quickOriginUptime.textContent = originFormatted || (data.originUptime ? String(data.originUptime) : '—');

        // maintain history
        if (latency !== null) history.push(latency);
        else history.push(0);
        if (history.length > MAX_HISTORY) history.shift();
        drawSpark(history);

        // latency fill bar (map to percentage of 1000ms)
        const max = 1000;
        const pct = latency === null ? 0 : Math.min(100, Math.round((latency / max) * 100));
        latencyFill.style.width = pct + '%';

        // raw json
        if (showRaw.checked) {
          rawJson.style.display = 'block';
          try { rawJson.textContent = JSON.stringify(data, null, 2); } catch (e) { rawJson.textContent = String(data); }
        } else {
          rawJson.style.display = 'none';
        }
      }

      // fetch once and normalize results
      async function fetchStatusOnce() {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 4500);
        try {
          const res = await fetch(STATUS_ENDPOINT + (STATUS_ENDPOINT.includes('?') ? '&' : '?') + 't=' + Date.now(), { signal: controller.signal, cache: 'no-store', mode: 'cors' });
          clearTimeout(timeout);

          if (!res.ok) {
            const text = await res.text().catch(() => '');
            updateUI({ online: false, latency: null, bandwidth: 0, cache: 'unknown', statusCode: res.status, timestamp: Date.now(), rawText: text });
            return;
          }

          // try parse JSON, fallback to text
          let json;
          try {
            json = await res.json();
          } catch (err) {
            const txt = await res.text().catch(() => null);
            // some endpoints may return plain text with metrics; present as raw
            updateUI({ online: true, latency: null, bandwidth: 0, cache: 'unknown', statusCode: res.status, timestamp: Date.now(), raw: txt });
            return;
          }

          const out = {
            online: json.online !== undefined ? json.online : (json.ok || (json.statusCode && json.statusCode >= 200 && json.statusCode < 400)),
            latency: json.latency !== undefined ? Number(json.latency) : (json.time !== undefined ? Number(json.time) : null),
            bandwidth: json.bandwidth !== undefined ? Number(json.bandwidth) : (json.size !== undefined ? Number(json.size) : 0),
            cache: json.cache || (json.headers && (json.headers['x-cache'] || json.headers['x-nf-cache'])) || (json.cacheStatus || null),
            statusCode: json.statusCode || json.status || res.status,
            timestamp: json.timestamp || Date.now(),
            uptime: json.uptime !== undefined ? json.uptime : (json.uptime_percent !== undefined ? json.uptime_percent : null),
            uptimeFormatted: json.uptimeFormatted || json.uptime_formatted || json.uptimeString || null,
            originUptimeFormatted: json.originUptimeFormatted || json.origin_uptime_formatted || null,
            raw: json
          };

          updateUI(out);
        } catch (err) {
          clearTimeout(timeout);
          updateUI({ online: false, latency: null, bandwidth: 0, cache: 'none', statusCode: 0, timestamp: Date.now() });
          rawJson.style.display = 'block';
          rawJson.textContent = `Fetch error: ${err && err.message ? err.message : String(err)}\n\nJika Pesan Ini Muncul, Periksa WiFi/Internet Anda Atau Refresh Halaman Ini.`;
        }
      }

      async function poll() {
        if (!running) return;
        await fetchStatusOnce();
        timerId = setTimeout(poll, POLL_MS);
      }

      // UI actions
      forceBtn.addEventListener('click', async () => { await fetchStatusOnce(); });
      pauseBtn.addEventListener('click', () => {
        running = !running;
        pauseBtn.textContent = running ? 'Pause' : 'Resume';
        if (running) poll();
        else if (timerId) clearTimeout(timerId);
      });

      showRaw.addEventListener('change', () => {
        rawJson.style.display = showRaw.checked ? 'block' : 'none';
      });

      window.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible' && running && !timerId) poll();
        if (document.visibilityState !== 'visible' && timerId) { clearTimeout(timerId); timerId = null; }
      });

      // start after splash (give small delay)
      setTimeout(() => { poll(); }, 800);

      // expose helpers
      window.__kyrt_status = { pollNow: fetchStatusOnce, stop: () => { running = false; if (timerId) clearTimeout(timerId); }, start: () => { if (!running) { running = true; poll(); } } };

      // --- seed raw JSON with example (optional) ---
      try {
        const sample = {
          "target": "https://cdn.kyrt.my.id/",
          "online": null,
          "statusCode": null,
          "latency": null,
          "cache": null,
          "cacheReason": null,
          "bandwidth": null,
          "uptime": null,
          "uptimeFormatted": null,
          "originUptime": null,
          "originUptimeFormatted": null,
          "timestamp": Date.now()
        };
        rawJson.textContent = JSON.stringify(sample, null, 2);
      } catch (e) { /* ignore */ }

    })();
  </script>
</body>
                                                                                   </html>
