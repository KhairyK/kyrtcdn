!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?module.exports=n():e.AnaLy=n()}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(){return function e(){"use strict";let n=(e,n=null)=>{try{return e()}catch(t){return n}},t=async(e,n=null)=>{try{return await e()}catch(t){return n}},r=()=>new Date().toISOString(),i=(e,n=1200)=>{let t=null;return function(...r){clearTimeout(t),t=setTimeout(()=>e.apply(this,r),n)}},a="undefined"!=typeof window,o=()=>"undefined"!=typeof navigator?navigator.userAgent:"",l=()=>"undefined"!=typeof navigator&&navigator.platform||"",d=()=>"undefined"!=typeof navigator&&(navigator.language||navigator.languages&&navigator.languages[0])||null,u=()=>n(()=>Intl&&Intl.DateTimeFormat?Intl.DateTimeFormat().resolvedOptions().timeZone:null,null),s={anonymizeIP:!0,anonymizeUA:!1,anonymizeHardware:!0,autoSend:!1,url:null,debounceMs:1200,verbose:!1,preferAsyncSnapshotForSend:!0,includeOnInit:!0};function c(e){for(let n of[{name:"Edge (Chromium)",regex:/EdgA?\/([\d.]+)/},{name:"Edge (Legacy)",regex:/Edge\/([\d.]+)/},{name:"Opera",regex:/OPR\/([\d.]+)/},{name:"Vivaldi",regex:/Vivaldi\/([\d.]+)/},{name:"Brave",regex:/Brave\/([\d.]+)/},{name:"Chrome",regex:/Chrome\/([\d.]+)/},{name:"Samsung Internet",regex:/SamsungBrowser\/([\d.]+)/},{name:"Firefox",regex:/Firefox\/([\d.]+)/},{name:"Safari",regex:/Version\/([\d.]+).*Safari/},{name:"IE",regex:/MSIE\s([\d.]+)|Trident\/.*rv:([\d.]+)/},{name:"UC Browser",regex:/UCBrowser\/([\d.]+)/},{name:"QQ Browser",regex:/QQBrowser\/([\d.]+)/}]){let t=e.match(n.regex);if(t)return{name:n.name,version:t[1]||t[2]||"unknown"}}return{name:"Unknown",version:"0"}}function f(e,n){let t="undefined"!=typeof navigator&&("maxTouchPoints"in navigator?navigator.maxTouchPoints>0:"ontouchstart"in window);if(/Android/.test(e))return"Android";if(/iPhone/.test(e))return"iOS (iPhone)";if(/iPad/.test(e))return"iOS (iPad)";if(/iPod/.test(e))return"iOS (iPod)";if(/Macintosh/.test(e)||/Mac OS X/.test(e)||/MacIntel/.test(n))return t&&!/CriOS|FxiOS|EdgiOS/.test(e)?"iPadOS":"macOS";for(let r of[{re:/Windows NT 10\.0/,name:"Windows 10/11"},{re:/Windows NT 6\.3/,name:"Windows 8.1"},{re:/Windows NT 6\.2/,name:"Windows 8"},{re:/Windows NT 6\.1/,name:"Windows 7"},{re:/Windows NT 6\.0/,name:"Windows Vista"},{re:/Windows NT 5\.1|Windows XP/,name:"Windows XP"}])if(r.re.test(e))return r.name;return/CrOS/.test(e)?"ChromeOS":/Linux/.test(e)?"Linux":/Windows Phone/.test(e)?"Windows Phone":/Mobi/.test(e)||t?"Mobile (unknown)":"Unknown"}function m(){return{es6:n(()=>(Function("(a = 0) => a"),!0),!1),promises:"undefined"!=typeof Promise,fetch:"undefined"!=typeof fetch,asyncAwait:n(()=>(Function("async function test(){}"),!0),!1),dynamicImport:n(()=>(Function("import('data:text/javascript,')"),!0),!1),webAssembly:"undefined"!=typeof WebAssembly,serviceWorker:"undefined"!=typeof navigator&&"serviceWorker"in navigator,notifications:"undefined"!=typeof Notification,clipboard:"undefined"!=typeof navigator&&"clipboard"in navigator,webGL:n(()=>{let e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))},!1)}}function p(){let e=n(()=>navigator.hardwareConcurrency||null,null),t=n(()=>navigator.deviceMemory||null,null),r=n(()=>{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return{vendor:null,renderer:null};let r=t.getExtension("WEBGL_debug_renderer_info");if(r){let i=t.getParameter(r.UNMASKED_VENDOR_WEBGL),a=t.getParameter(r.UNMASKED_RENDERER_WEBGL);return{vendor:i||null,renderer:a||null}}let o=n(()=>t.getParameter(t.RENDERER)||null,null);return{vendor:null,renderer:o}},{vendor:null,renderer:null});return{cores:e,deviceMemory:t,gpu:r}}function y(){return{language:d(),languages:n(()=>navigator.languages?navigator.languages.slice(0,5):null,null),timezone:u()}}async function g(){if(!navigator.storage||!navigator.storage.estimate)return null;try{let e=await navigator.storage.estimate();return{quota:e.quota||null,usage:e.usage||null,usagePercentage:e.quota?e.usage/e.quota:null}}catch(n){return null}}async function v(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return null;try{let e=await navigator.mediaDevices.enumerateDevices(),n={devices:e.map(e=>({kind:e.kind,label:e.label||null,deviceId:e.deviceId||null})),hasCamera:!1,hasMicrophone:!1};for(let t of e)"videoinput"===t.kind&&(n.hasCamera=!0),"audioinput"===t.kind&&(n.hasMicrophone=!0);return n}catch(r){return null}}function h(e={},t={}){let i=Object.assign({},s,t),d=o(),u=l(),g=c(d),v=f(d,u),h={cookies:n(()=>!0===navigator.cookieEnabled,!1),localStorage:n(()=>("undefined"!=typeof localStorage&&(localStorage.setItem("__ana_test__","1"),localStorage.removeItem("__ana_test__")),!0),!1),sessionStorage:n(()=>("undefined"!=typeof sessionStorage&&(sessionStorage.setItem("__ana_test__","1"),sessionStorage.removeItem("__ana_test__")),!0),!1),geolocation:n(()=>"undefined"!=typeof navigator&&"geolocation"in navigator,!1),serviceWorker:n(()=>"undefined"!=typeof navigator&&"serviceWorker"in navigator,!1),webGL:n(()=>{let e="undefined"!=typeof document?document.createElement("canvas"):null;return!!("undefined"!=typeof window&&window.WebGLRenderingContext&&e&&(e.getContext("webgl")||e.getContext("experimental-webgl")))},!1)},w={timestamp:r(),userAgent:d,platform:u,browser:g,os:v,locale:y(),features:h,jsFeatures:m(),hardware:p(),screen:{width:n(()=>window.screen.width,null),height:n(()=>window.screen.height,null),availWidth:n(()=>window.screen.availWidth,null),availHeight:n(()=>window.screen.availHeight,null),orientation:n(()=>screen&&screen.orientation?screen.orientation.type:null,null),pixelRatio:n(()=>window.devicePixelRatio||1,1),viewportWidth:n(()=>Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),null),viewportHeight:n(()=>Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),null)},network:function e(){let t=n(()=>navigator.connection||navigator.mozConnection||navigator.webkitConnection,null);return{online:n(()=>!0===navigator.onLine,!1),effectiveType:n(()=>t&&t.effectiveType||null,null),downlink:n(()=>t&&t.downlink||null,null),rtt:n(()=>t&&t.rtt||null,null),saveData:n(()=>t&&t.saveData||!1,!1),ip:null}}(),privacy:{adblock:n(()=>(function e(){try{if(!a||!document.body)return null;let n=document.createElement("div");n.className="adsbox ad_banner adsense",n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n);let t=window.getComputedStyle?getComputedStyle(n):null,r=!n.offsetParent||t&&("none"===t.display||"hidden"===t.visibility);return document.body.removeChild(n),r}catch(i){return null}})(),null),cspMeta:function e(){try{let n="undefined"!=typeof document?document.querySelector('meta[http-equiv="Content-Security-Policy"]'):null;return n?n.getAttribute("content"):null}catch(t){return null}}(),evalAllowed:n(()=>(Function("return 1")(),!0),!1),secureOrigin:n(()=>"undefined"!=typeof location&&"https:"===location.protocol,!1)},media:{audioCodecs:function e(){let t="undefined"!=typeof document?document.createElement("audio"):{canPlayType:()=>""};return{mpeg:n(()=>!!t.canPlayType&&!!t.canPlayType("audio/mpeg;").replace(/no/i,""),null),opus:n(()=>!!t.canPlayType&&!!t.canPlayType('audio/ogg; codecs="opus"').replace(/no/i,""),null),wav:n(()=>!!t.canPlayType&&!!t.canPlayType('audio/wav; codecs="1"').replace(/no/i,""),null)}}(),videoCodecs:function e(){let t="undefined"!=typeof document?document.createElement("video"):{canPlayType:()=>""};return{h264_mp4:n(()=>!!t.canPlayType&&!!t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/no/i,""),null),webm_vp9:n(()=>!!t.canPlayType&&!!t.canPlayType('video/webm; codecs="vp9"').replace(/no/i,""),null),webm_vp8:n(()=>!!t.canPlayType&&!!t.canPlayType('video/webm; codecs="vp8"').replace(/no/i,""),null)}}(),mediaDevicesQuick:null},inputs:{touch:n(()=>"maxTouchPoints"in navigator?navigator.maxTouchPoints:"ontouchstart"in window?1:0,0),pointer:n(()=>"undefined"!=typeof window&&!!window.PointerEvent,!1),hover:n(()=>"undefined"!=typeof window&&window.matchMedia?window.matchMedia("(hover: hover)").matches:null,null),anyHover:n(()=>"undefined"!=typeof window&&window.matchMedia?window.matchMedia("(any-hover: hover)").matches:null,null),gamepads:n(()=>navigator.getGamepads&&navigator.getGamepads().length||0,0)},extra:e||{}};return i.anonymizeUA&&(w.userAgent="[ANONYMIZED]",w.browser={name:w.browser&&w.browser.name?w.browser.name:"Unknown",version:"[ANONYMIZED]"}),i.anonymizeHardware&&w.hardware&&(w.hardware.cores=null,w.hardware.deviceMemory=null,w.hardware.gpu={vendor:null,renderer:null}),i.anonymizeIP&&w.network&&"ip"in w.network&&(w.network.ip=null),w}async function w(e={},r={}){let i=Object.assign({},s,r),a=h(e,i),[o,l,d]=await Promise.all([t(async()=>navigator.getBattery?await navigator.getBattery():null,null),t(g,null),t(v,null)]),u=o?{charging:n(()=>o.charging,null),level:n(()=>o.level,null),chargingTime:n(()=>o.chargingTime,null),dischargingTime:n(()=>o.dischargingTime,null)}:null;return a.battery=u,a.storage=l,a.media.mediaDevicesQuick=d,i.anonymizeHardware&&a.hardware&&(a.hardware.cores=null,a.hardware.deviceMemory=null,a.hardware.gpu={vendor:null,renderer:null}),i.anonymizeIP&&a.network&&"ip"in a.network&&(a.network.ip=null),i.anonymizeUA&&(a.userAgent="[ANONYMIZED]",a.browser&&(a.browser.version="[ANONYMIZED]")),a}async function b(e,n,t={}){if(!e){t&&t.verbose&&console.warn("AnaLy.js: no url for send");return}try{await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),keepalive:!0}),t&&t.verbose&&console.info("AnaLy.js: sent payload",n)}catch(r){t&&t.verbose&&console.error("AnaLy.js: send failed",r)}}let E={realtimeRunning:!1,realtimeConfig:null,_dprMedia:null,_orientationHandler:null,_conn:null,_connHandler:null,_mqHandlerRef:null,debouncedSend:null},x=Object.assign({},s,{debounceMs:1200});function S(e={},n={}){let t=Object.assign({},s,n);return h(e,t)}function $(e={},n={}){let t=Object.assign({},s,n);return w(e,t)}function _(e,n,t){if(t||(t=E.realtimeConfig||x),t.preferAsyncSnapshotForSend)w(n,t).then(n=>{E.debouncedSend?E.debouncedSend(n):b(e,n,t)}).catch(()=>{let r=h(n,t);E.debouncedSend?E.debouncedSend(r):b(e,r,t)});else{let r=h(n,t);E.debouncedSend?E.debouncedSend(r):b(e,r,t)}}function P(e,t={},r={}){L();let o=Object.assign({},x,{url:e,extraData:t},r);E.realtimeConfig=o,E.debouncedSend=i(n=>b(e,n,o),o.debounceMs);let l=()=>_(e,t,o);if(a){if(window.addEventListener("online",l,{passive:!0}),window.addEventListener("offline",l,{passive:!0}),window.addEventListener("resize",l,{passive:!0}),window.matchMedia)try{let d=`(resolution: ${window.devicePixelRatio}dppx)`,u=window.matchMedia(d),s=l;"function"==typeof u.addEventListener?u.addEventListener("change",s):"function"==typeof u.addListener&&u.addListener(s),E._dprMedia={mm:u,mqHandler:s}}catch(c){}"undefined"!=typeof screen&&screen.orientation&&"function"==typeof screen.orientation.addEventListener&&(screen.orientation.addEventListener("change",l),E._orientationHandler=l);let f=n(()=>navigator.connection||navigator.mozConnection||navigator.webkitConnection,null);f&&"function"==typeof f.addEventListener&&(f.addEventListener("change",l),E._conn=f,E._connHandler=l),o.autoSend&&o.includeOnInit&&o.url&&l(),E.realtimeRunning=!0,o.verbose&&console.info("AnaLy.js: realtime started",o)}}function L(){if(!a||!E.realtimeRunning)return;let e=E.realtimeConfig||{},n=()=>_(e.url,e.extraData,e);try{window.removeEventListener("online",n)}catch(t){}try{window.removeEventListener("offline",n)}catch(r){}try{window.removeEventListener("resize",n)}catch(i){}if(E._orientationHandler&&"undefined"!=typeof screen&&screen.orientation){try{screen.orientation.removeEventListener("change",E._orientationHandler)}catch(o){}E._orientationHandler=null}if(E._dprMedia&&E._dprMedia.mm){try{let{mm:l,mqHandler:d}=E._dprMedia;"function"==typeof l.removeEventListener?l.removeEventListener("change",d):"function"==typeof l.removeListener&&l.removeListener(d)}catch(u){}E._dprMedia=null}if(E._conn&&E._connHandler){try{E._conn.removeEventListener("change",E._connHandler)}catch(s){}E._conn=null,E._connHandler=null}E.debouncedSend=null,E.realtimeRunning=!1,E.realtimeConfig=null,e&&e.verbose&&console.info("AnaLy.js: realtime stopped")}return{version:"1.0",getSnapshot:S,getSnapshotAsync:$,sendData:function e(n,t={},r={}){let i=Object.assign({},s,r);return $(t,i).then(e=>b(n,e,i))},setupRealtime:P,stopRealtime:L,init:function e(n={}){let t=Object.assign({},x,n);return(E.realtimeConfig=t,t.autoSend&&t.url&&P(t.url,t.extraData,t),t.verbose&&console.info("AnaLy.js initialized",t),t.preferAsyncSnapshotForSend)?$(t.extraData,t):S(t.extraData,t)},logAll:function e(n={},t={}){let r=h(n,t);return console.group&&console.group("AnaLy.js v1.0 Snapshot"),console.info("timestamp:",r.timestamp),console.info("userAgent:",r.userAgent),console.info("browser:",r.browser),console.info("os:",r.os),console.info("locale:",r.locale),console.info("features:",r.features),console.info("jsFeatures:",r.jsFeatures),console.info("hardware:",r.hardware),console.info("battery:","(use getSnapshotAsync to see full battery info)"),console.info("screen:",r.screen),console.info("network:",r.network),console.info("privacy:",r.privacy),console.info("media:",r.media),console.info("inputs:",r.inputs),console.groupEnd&&console.groupEnd(),r},detectBrowser:()=>c(o()),detectOS:()=>f(o(),l()),detectJSFeatures:m,detectHardware:p,detectLocale:y,detectMediaDevices:v,detectStorageEstimate:g}}()});
